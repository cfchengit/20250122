<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¸ç”Ÿä½œå“å±•ç¤º</title>
    <link rel="stylesheet" type="text/css" href="/style.css">
    <style>
        .preview-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }
        
        .preview-frame-container {
            position: relative;
            width: 90%;
            height: 90%;
            margin: auto;
            top: 5%;
            background: white;
        }

        .preview-frame {
            width: 100%;
            height: 100%;
            border: none;
        }

        .close-preview {
            position: absolute;
            top: 10px;
            right: 20px;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .file-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .file-icon {
            margin-right: 10px;
        }

        .preview-button {
            margin-left: 10px;
            padding: 5px 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .preview-button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>å­¸ç”Ÿä½œå“å±•ç¤º</h1>
        <div id="studentWorks">
            <!-- ä½œå“å°‡åœ¨é€™è£¡é¡¯ç¤º -->
        </div>
    </div>

    <div class="preview-container" id="previewContainer">
        <span class="close-preview" onclick="closePreview()">&times;</span>
        <div class="preview-frame-container">
            <iframe class="preview-frame" id="previewFrame"></iframe>
        </div>
    </div>

    <script>
        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const icons = {
                'html': 'ğŸŒ',
                'htm': 'ğŸŒ',
                'css': 'ğŸ¨',
                'js': 'ğŸ“œ',
                'jpg': 'ğŸ–¼ï¸',
                'jpeg': 'ğŸ–¼ï¸',
                'png': 'ğŸ–¼ï¸',
                'gif': 'ğŸ–¼ï¸',
                'pdf': 'ğŸ“„',
                'zip': 'ğŸ“¦'
            };
            return icons[ext] || 'ğŸ“„';
        }

        function showPreview(url) {
            document.getElementById('previewContainer').style.display = 'block';
            document.getElementById('previewFrame').src = url;
        }

        function closePreview() {
            document.getElementById('previewContainer').style.display = 'none';
            document.getElementById('previewFrame').src = '';
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const studentId = window.location.pathname.split('/').pop();
            const studentWorks = document.getElementById('studentWorks');

            try {
                const response = await fetch(`/files/${studentId}`);
                const data = await response.json();
                
                if (data.length === 0) {
                    studentWorks.innerHTML = '<p>ç›®å‰æ²’æœ‰ä¸Šå‚³çš„ä½œå“</p>';
                    return;
                }

                studentWorks.innerHTML = `<h2>å­¸è™Ÿ ${studentId} çš„ä½œå“ï¼š</h2>`;
                
                // ä¾é€±æ¬¡æ’åº
                data.sort((a, b) => {
                    const weekA = parseInt(a.week.replace('week', ''));
                    const weekB = parseInt(b.week.replace('week', ''));
                    return weekA - weekB;
                });

                // é¡¯ç¤ºæ¯é€±çš„ä½œå“
                data.forEach(weekData => {
                    const weekNumber = weekData.week.replace('week', '');
                    const weekHtml = `
                        <div class="week-section">
                            <h3>ç¬¬ ${weekNumber} é€±</h3>
                            <div class="file-list">
                                ${weekData.files.map(file => {
                                    const isPreviewable = file.name.match(/\.(html|htm|jpg|jpeg|png|gif|pdf)$/i);
                                    const previewUrl = `/preview/${studentId}/${weekData.week}/${file.name}`;
                                    return `
                                        <div class="file-item">
                                            <span class="file-icon">${getFileIcon(file.name)}</span>
                                            <a href="${file.path}" target="_blank">${file.name}</a>
                                            ${isPreviewable ? `
                                                <button class="preview-button" onclick="showPreview('${previewUrl}')">
                                                    é è¦½
                                                </button>
                                            ` : ''}
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                    studentWorks.innerHTML += weekHtml;
                });
            } catch (error) {
                console.error('ç²å–ä½œå“åˆ—è¡¨å¤±æ•—ï¼š', error);
                studentWorks.innerHTML = '<p>è¼‰å…¥ä½œå“æ™‚ç™¼ç”ŸéŒ¯èª¤</p>';
            }
        });
    </script>
</body>
</html> 